from evmlab import compiler
from evmlab import json_template
import json
HEX_FORMAT = '#0x'
TESTFILE_PATH = './output/merkle-prove-solidity.json'

# Case abcdefgh
# root = 0xc5951687c471cbf18c853651b13c98a590f98590173e9350540f965b11e44d28
# leaf = 0x0ef9d8f8804d174666011a394cab7901679a8944d24249fd148a6a36071151f8
# path = [0x60811857dd566889ff6255277d82526f2d9b3bbcb96076be22a5860765ac3d06,
#         0xc4190c5ad27401fb41ad418e06f19aa3ce47011a031bd91c65959c7b681ce6e9,
#         0x7008e56851ecbe2dcf3ec955381a51003102af3ec3829a1e6e4d450d7b37548c]
# pathLen = 96

leaf = 0x0ef9d8f8804d174666011a394cab7901679a8944d24249fd148a6a36071151f8
path = [0x60811857dd566889ff6255277d82526f2d9b3bbcb96076be22a5860765ac3d06]
root = 0x905be01e25a661e3918a53a7206cb16ad11eb184bb53275f975607e8f245ad6e

# Construct bytecode
p = compiler.Program()
#for i in range(len(path)):
#    p.mstore(100+(i*32), path[i])

# prove(proof, leaf, root)
input_data = []
input_data.append(hex(path[0]))
input_data.append(hex(leaf))
input_data.append(hex(root))
print(input_data)

raw_code = '341561000a57600080fd5b610074600480803590602001908201803590602001908080601f01602080910402602001604051908101604052809392919081815260200183838082843782019150505050505091908035600019169060200190919080356000191690602001909190505061008e565b604051808215151515815260200191505060405180910390f35b6000806000806000602088518115156100a357fe5b061415156100b057600080fd5b859150602092505b86518310156101485782870151905080600019168260001916101561010c5781816040518083600019166000191681526020018260001916600019168152602001925050506040518091039020915061013d565b8082604051808360001916600019168152602001826000191660001916815260200192505050604051809103902091505b6020830192506100b8565b8460001916826000191614935050505093925050505600a165627a7a7230582040711e4ec410bfad60fd18947a2394b2b8ff0952715e351023881e6734f022f30029'


start_gas = 2000
end_gas = (start_gas - 20)


# Write to file
print('0x' + p.bytecode())
print('Writing to file...')
f = open(TESTFILE_PATH, 'w')
# Code, start gas, end gas, name, input, output
json.dump(json_template.get_json(raw_code, start_gas, end_gas, 'merkle-prove-solidity', input_data, True), f, indent=4)
f.close()
print('Done!')
